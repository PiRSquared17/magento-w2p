<?xml version="1.0" ?>
<config>
  <modules>
    <ZetaPrints_OrderApproval>
      <version>2</version>
    </ZetaPrints_OrderApproval>
  </modules>

  <global>
    <models>
      <orderapproval>
        <class>ZetaPrints_OrderApproval_Model</class>
      </orderapproval>

      <checkout>
        <rewrite>
          <cart>ZetaPrints_OrderApproval_Model_Cart</cart>
        </rewrite>
      </checkout>

      <sales>
        <rewrite>
          <quote>ZetaPrints_OrderApproval_Model_Quote</quote>
          <quote_address>ZetaPrints_OrderApproval_Model_Quote_Address</quote_address>
        </rewrite>
      </sales>
    </models>

    <blocks>
      <orderapproval>
        <class>ZetaPrints_OrderApproval_Block</class>
      </orderapproval>

      <checkout>
        <rewrite>
          <cart>ZetaPrints_OrderApproval_Block_Cart</cart>
        </rewrite>
      </checkout>
    </blocks>

    <helpers>
      <orderapproval>
        <class>ZetaPrints_OrderApproval_Helper</class>
      </orderapproval>
    </helpers>

    <resources>
      <orderapproval_setup>
        <setup>
          <module>ZetaPrints_OrderApproval</module>
          <class>Mage_Eav_Model_Entity_Setup</class>
        </setup>
        <connection>
          <use>default_setup</use>
        </connection>
      </orderapproval_setup>

      <orderapproval_write>
        <connection><use>default_write</use></connection>
      </orderapproval_write>

      <orderapproval_read>
        <connection><use>default_read</use></connection>
      </orderapproval_read>
    </resources>

    <events>
      <checkout_cart_product_add_after>
        <observers>
          <orderapproval-mark-quote-item>
            <type>singleton</type>
            <class>ZetaPrints_OrderApproval_Model_Events_Observer</class>
            <method>mark_quote_item</method>
          </orderapproval-mark-quote-item>
        </observers>
      </checkout_cart_product_add_after>

      <checkout_cart_product_update_after>
        <observers>
          <orderapproval-mark-quote-item>
            <type>singleton</type>
            <class>ZetaPrints_OrderApproval_Model_Events_Observer</class>
            <method>mark_quote_item</method>
          </orderapproval-mark-quote-item>
        </observers>
      </checkout_cart_product_update_after>

      <controller_action_predispatch_checkout_cart_index>
        <observers>
          <orderapproval-check-for-not-sent-items>
            <type>singleton</type>
            <class>ZetaPrints_OrderApproval_Model_Events_Observer</class>
            <method>check_for_not_sent_items</method>
          </orderapproval-check-for-not-sent-items>
        </observers>
      </controller_action_predispatch_checkout_cart_index>

      <!-- For compatibility with M. verion < 1.4.1.0 -->
      <!--<sales_model_service_quote_submit_success>-->
      <sales_model_service_quote_submit_after>
        <observers>
          <orderapproval-remove-approved-item-from-quote>
            <type>singleton</type>
            <class>ZetaPrints_OrderApproval_Model_Events_Observer</class>
            <method>remove_approved_items_from_quote</method>
          </orderapproval-remove-approved-item-from-quote>
        </observers>
      </sales_model_service_quote_submit_after>
      <!--</sales_model_service_quote_submit_success>-->

      <!--<controller_action_layout_render_before_customer_account>
        <observers>
          <orderapproval-add-menu-item>
            <type>singleton</type>
            <class>ZetaPrints_OrderApproval_Model_Events_Observer</class>
            <method>addCartsMenuItem</method>
          </orderapproval-add-menu-item>
        </observers>
      </controller_action_layout_render_before_customer_account>-->
    </events>

    <rewrite>
      <ZetaPrints_OrderApproval_Onepage>
        <from><![CDATA[#^/checkout/onepage/#]]></from>
        <to>/order-approval/onepage/</to>
      </ZetaPrints_OrderApproval_Onepage>

      <ZetaPrints_OrderApproval_Cart>
        <from><![CDATA[#^/checkout/cart/#]]></from>
        <to>/order-approval/cart/</to>
      </ZetaPrints_OrderApproval_Cart>
    </rewrite>

    <template>
      <email>
        <sales_email_orderapproval_new_items_template translate="label" module="orderapproval">
          <label>New Items To Approve</label>
          <file>sales/new-items-to-approve.txt</file>
          <type>txt</type>
        </sales_email_orderapproval_new_items_template>
      </email>
    </template>
  </global>

  <frontend>
    <routers>
      <orderapproval>
        <use>standard</use>
        <args>
          <module>ZetaPrints_OrderApproval</module>
          <frontName>order-approval</frontName>
        </args>
      </orderapproval>
    </routers>

    <layout>
      <updates>
        <orderapproval>
          <file>order-approval.xml</file>
        </orderapproval>

        <checkout-cart-edit>
          <file>checkout/cart-edit.xml</file>
        </checkout-cart-edit>
      </updates>
    </layout>
  </frontend>

  <default>
    <sales_email>
      <orderapproval>
        <new_items_template>sales_email_orderapproval_new_items_template</new_items_template>
      </orderapproval>
    </sales_email>
  </default>
</config>
